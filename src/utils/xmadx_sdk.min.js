"use strict";var xmad=function(a,b){function c(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var b;try{if(b=wx.getStorageSync("xmaduuid"),b)return b}catch(a){}b=a()+a()+a()+a()+a()+a()+a()+a();try{wx.setStorageSync("xmaduuid",b)}catch(a){}return b}function d(a){var b=a.currentTarget.dataset.id,c=this.data.xmad;c.adData[b].hasshow=!1,this.setData({xmad:c})}function e(a){var b=a.currentTarget.dataset.id,c=n[b].curl.replace(/cst=/gi,"cst="+Date.now());c=c.split("?")[1];var d=n[b].at;if(1===d){var e=g?k.h5_path||"/pages/xmadH5":k.h5_path||"/pages/xmadH5/xmadH5",f=n[b].h5link.replace("?","|").replace("=","$");f&&wx.navigateTo({url:e+"?xmadH5url="+f,success:function(){z(c,"v1/api/clk",["log","imp"],function(){},"get")},fail:function(){console.warn("\u5C0F\u76DF\u63D0\u793A\uFF1A\u8DF3\u8F6CH5\u5E7F\u544A\u5931\u8D25\uFF0C\u8BF7\u5728xmadx_conf.js\u4E2D\u6B63\u786E\u914D\u7F6Eh5_path\u5B57\u6BB5\u3002")}})}2===d&&(!a.currentTarget.dataset.adImgUrl&&(a.currentTarget.dataset.adImgUrl=n[b].appimg),wx.previewImage({current:a.currentTarget.dataset.adImgUrl,urls:[a.currentTarget.dataset.adImgUrl],success:function(){z(c,"v1/api/clk",["log","imp"],function(){},"get")}})),3===d&&z(c,"v1/api/clk",["log","imp"],function(){},"get"),1!==d&&2!==d&&3!==d&&console.error("SDK\u9519\u8BEF\uFF1A\u8DF3\u8F6C\u7C7B\u578Bat\u4E3A\uFF1A"+d+"\uFF0C\u4E0D\u662F\u7EA6\u5B9A\u7684\u7C7B\u578B\u3002\u65E0\u6CD5\u8FDB\u884C\u8DF3\u8F6C\u3001\u70B9\u51FB\u4E0A\u62A5\uFF0C\u8054\u7CFBGO\u5DE5\u7A0B\u5E08\uFF01\uFF01\uFF01")}function f(a,b,c){if(a[b]){var d=a[b];a[b]=function(b){return d.call.apply(d,[this].concat(Array.prototype.slice.call(arguments))),c.call(this,b,a)}}else a[b]=function(a){c.call(this,a,b)}}try{var g="wepy"===a}catch(a){}try{var h=a.prototype.constructor.name;if(h){var i,j;"App"===b?i=a:j=a}}catch(a){}var k=require("./xmadx_conf.js"),l=require("./xmadx_MD5.js"),m=0,n={};if(!k.app_key||32!==k.app_key.length){console.warn("\u5C0F\u76DF\u63D0\u793A\uFF1A\u914D\u7F6E\u9519\u8BEF\uFF0C\u8BF7\u5728xmadx_conf.js\u4E2D\u6B63\u786E\u914D\u7F6E\u60A8\u7684app_key\u3002");var o=function(a){i?i(a):App(a)},p=function(a){j?j(a):Page(a)};return{xmApp:o,xmPage:p}}var q={ak:k.app_key.replace(/(^\s*)|(\s*$)/g,""),v:"1.3.7",asid:"",reqid:"",pb:"",pm:"",sv:"",pv:"",nt:"",ww:0,wh:0,pr:0,long:0,lat:0,wvv:"",wv:"",lang:"",wsr:{},pp:"",uuid:"",user_info:{}},r=0,s=function(a){function b(){var b=4===c.length;b&&a&&(r=1,a())}var c=[];(function(){wx.getSetting({success:function(a){a.authSetting["scope.userInfo"]?wx.getUserInfo({withCredentials:!1,success:function(a){q.user_info=a.userInfo},complete:function(){c.push("ok1"),b()}}):(c.push("ok1"),b())},fail:function(){c.push("ok1"),b()}})})(),function(){wx.getSystemInfo({success:function(a){q.wv="undefined"==typeof a.SDKVersion?"1.0.0":a.SDKVersion,q.pb=a.brand,q.pm=a.model,q.pr=a.pixelRatio,q.ww=a.screenWidth,q.wh=a.screenHeight,q.lang=a.language,q.wvv=a.version,q.sv=a.system,q.pv=a.platform},complete:function(){c.push("ok2"),b()}})}(),function(){wx.getSetting({success:function(a){a.authSetting["scope.userLocation"]?wx.getLocation({type:"wgs84",success:function(a){q.long=a.latitude,q.lat=a.longitude},complete:function(){c.push("ok3"),b()}}):(c.push("ok3"),b())},fail:function(){c.push("ok3"),b()}})}(),function(){wx.getNetworkType({success:function(a){q.nt=a.networkType},complete:function(){c.push("ok4"),b()}})}()},t=function(a){wx.setStorageSync("xmwsr",a);var b=c();q.uuid=b,s()},u=function(){var a=this.options.xmadH5url;a&&(a=a.replace("|","?").replace("$","="),this.setData({xmadURL:a}))},v=function(){q.wsr=wx.getStorageSync("xmwsr"),q.pp=this.route;try{var a=this.data.xmad.ad}catch(a){}if(a)for(var b in a)x(this,a[b])},w=function(a,b){wx.createSelectorQuery().selectAll(a).boundingClientRect(function(a){if(b)return b(0<a.length)}).exec()},x=function(a,b){return 32==b.length?void A(b,["engine","v1/api/ad"],function(c){if(200==c.data.code){var d=c.data.data;n[b]=d,n[b].hasshow=!0,n[b].id=b,n[b].push=0,1===d.ct&&w(".xm_banner",function(a){return a?void(E.banner_calc(function(){n[b].style=E.banner_style}),e()):(n[b]="",console.warn("\u5C0F\u76DF\u63D0\u793A\uFF1A\u60A8\u5728js\u4E2D\u914D\u7F6E\u7684"+b+"\u4E3Abanner\u5E7F\u544A\uFF0C\u800Cwxml\u4E2D\u6CA1\u6709\"xm_banner\"\u4EE3\u7801,\u8BF7\u68C0\u67E5"))}),2===d.ct&&w(".xm_insert",function(a){return a?void(n[b].style=E.screen_style,e()):(n[b]="",console.warn("\u5C0F\u76DF\u63D0\u793A\uFF1A\u60A8\u5728js\u4E2D\u914D\u7F6E\u7684"+b+" \u4E3A\u63D2\u5C4F\u5E7F\u544A\uFF0C\u800Cwxml\u4E2D\u6CA1\u6709'xm_insert'\u4EE3\u7801,\u8BF7\u68C0\u67E5"))}),3===d.ct&&w(".xm_fixed",function(a){return a?void(n[b].style=E.type3,e()):(n[b]="",console.warn("\u5C0F\u76DF\u63D0\u793A\uFF1A\u60A8\u5728js\u4E2D\u914D\u7F6E\u7684"+b+" \u4E3A\u60AC\u6D6E\u7A97\u5E7F\u544A\uFF0C\u800Cwxml\u4E2D\u6CA1\u6709'xm_fixed'\u4EE3\u7801,\u8BF7\u68C0\u67E5"))});var e=function(){var c=a.data.xmad;c.adData=n,g?a.xmapply(n):a.setData({xmad:c});var e=d.iurl.replace(/ist=/gi,"ist="+Date.now());e=e.split("?")[1],y(a,e,b,d.ct)}}else;}):console.warn("\u5E7F\u544A\u4F4DID\u5E94\u4E3A\u957F\u5EA6\u4E3A32\u4F4D\uFF0C\u8BF7\u68C0\u67E5\u60A8\u5728js\u4E2D'xmad'\u7684\u914D\u7F6E--"+b)},y=function(a,b,c,d){function e(){if(1===d){var e=wx.createIntersectionObserver(this,{thresholds:[.2],selectAll:!0});return void e.relativeToViewport().observe(".xm_banner",function(d){var f=a.data.xmad;.2<d.intersectionRatio&&0===f.adData[c].push&&(f.adData[c].push=1,a.setData({xmad:f}),z(b,"v1/api/imp",["log","imp"],function(){},"get"),e.disconnect())})}z(b,"v1/api/imp",["log","imp"],function(){},"get")}wx.createSelectorQuery().selectAll(".xm_component").boundingClientRect(function(a){for(var b=0;b<a.length;b++)a[b].dataset.id===c&&e()}).exec()},z=function(a,b){var c=c?"get":"post",d="https://log.xmadx.net/",e={};/imp/.test(b)?e.iurl=a:e.curl=a;var f=0;(function a(){wx.request({url:d+b,data:e,method:c?"post":"get",success:function(){},fail:function(){2>f&&(f++,e.retryTimes=f,setTimeout(function(){a()},1e3))}})})()},A=function(a,b,c,d){0===r?s(function(){B(a,c,b,d)}):B(a,c,b,d)},B=function(a,b,d,e){var e=e?"get":"post",f="https://"+d[0]+".xmadx.net/";if(q.asid=a,q.uuid=c(),"log"!=d[0]){var g=Date.now()+q.ak+q.uuid+q.asid;q.reqid=l.hexMD5(g)}var h=0,i=function a(){wx.request({url:f+d[1],data:q,header:{},method:e,success:function(a){b(a)},fail:function(){2>h&&(h++,q.retryTimes=h,setTimeout(function(){a()},1e3))}})};i()},C=function a(b){f(b,"onLaunch",t),a.prototype.xmad="xmad",i?i(b):App(b)},D=function(a){f(a,"onLoad",v),f(a,"onShow",u),f(a,"xmadClose",d),f(a,"appoIntView",e),j?j(a):Page(a)},E={banner_style:{wrap:"width: 100%; height: 166rpx; overflow: hidden; position: relative;",icon:"width: 76rpx!important; height: 24rpx!important; line-height: 24rpx; background: rgba(0, 0, 0, .2); font-size: 16rpx; position: absolute; left: 2rpx; bottom: 2rpx; color: #fff; text-align: center; border-radius: 16rpx;",img:"width: 100%; height: 166rpx;",nav:"position:absolute;left:0;right:0;top:0;bottom:0;margin:0;background:none;"},banner_calc:function(a){var b=this;wx.getSystemInfo({success:function(c){var d=c.screenWidth,e=2*(166*d/582);b.banner_style.wrap="width: 100%!important; height:"+e+"rpx; overflow: hidden; position: relative;",b.banner_style.img="width: 100%!important; height:"+e+"rpx;",a(b.banner_style)}})},screen_style:{wrap:"position: fixed; width: 100%; height: 100%; left: 0; top: 0; background: rgba(0, 0, 0, .3); z-index: 9999;",content:"position:relative;width: 600rpx!important; height: 500rpx; overflow: hidden; left: calc(50% - 300rpx); top: calc(50% - 250rpx)",img:" width: 100%; height: 500rpx!important;",close:"position: absolute; right: 0; top: 0; padding: 10rpx; width: 34rpx!important; height: 34rpx!important;z-index:2",nav:"position:absolute;left:0;right:0;top:0;bottom:0;margin:0;background:none;",icon:"width: 76rpx!important; height: 24rpx!important; line-height: 24rpx; background: rgba(0, 0, 0, .2); font-size: 16rpx; position: absolute; left: 2rpx; bottom: 2rpx; color: #fff; text-align: center; border-radius: 16rpx;"},type3:{wrap:"position: fixed; width: 120rpx!important; height: 120rpx!important; right: 60rpx; bottom: 60rpx; z-index: 9998;",img:" width: 100%; height: 100%;",nav:"position:absolute;left:0;right:0;top:0;bottom:0;margin:0;background:none;"}};return{xmApp:C,xmPage:D}};exports.xmad=xmad;